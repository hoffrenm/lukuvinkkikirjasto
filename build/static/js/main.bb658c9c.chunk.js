(this["webpackJsonplukuvinkkikirjasto-front"]=this["webpackJsonplukuvinkkikirjasto-front"]||[]).push([[0],{38:function(t,e,a){t.exports=a(67)},66:function(t,e,a){},67:function(t,e,a){"use strict";a.r(e);var n=a(0),r=a.n(n),c=a(18),i=a.n(c),u=a(16),s=a(5),o=a(12),l=a(1),p=a.n(l),d=a(3),f=a(4),m=a(11),v=a.n(m),b={getAll:function(){var t=Object(d.a)(p.a.mark((function t(){var e;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,v.a.get("".concat("/api","/tips"));case 2:return e=t.sent,t.abrupt("return",e);case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),getAllUnread:function(){var t=Object(d.a)(p.a.mark((function t(){var e;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,v.a.get("".concat("/api","/tips/unread"));case 2:return e=t.sent,t.abrupt("return",e);case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),getByTitle:function(){var t=Object(d.a)(p.a.mark((function t(e){var a;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,v.a.get("".concat("/api","/tips/title/").concat(e));case 2:return a=t.sent,t.abrupt("return",a);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),getByTag:function(){var t=Object(d.a)(p.a.mark((function t(e){var a;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("".concat("/api","/tags/").concat(e)),t.next=3,v.a.get("".concat("/api","/tags/").concat(e));case 3:return a=t.sent,t.abrupt("return",a);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),getById:function(){var t=Object(d.a)(p.a.mark((function t(e){var a;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,v.a.get("".concat("/api","/tips/").concat(e));case 2:return a=t.sent,t.abrupt("return",a);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),create:function(){var t=Object(d.a)(p.a.mark((function t(e){var a;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,v.a.post("".concat("/api","/tips"),e);case 2:return a=t.sent,t.abrupt("return",a);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),remove:function(){var t=Object(d.a)(p.a.mark((function t(e){var a;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,v.a.delete("".concat("/api","/tips/").concat(e));case 2:return a=t.sent,t.abrupt("return",a);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),update:function(){var t=Object(d.a)(p.a.mark((function t(e,a){var n;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,v.a.put("".concat("/api","/tips/").concat(e),a);case 2:return n=t.sent,t.abrupt("return",n);case 4:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}(),read:function(){var t=Object(d.a)(p.a.mark((function t(e){var a;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,v.a.post("".concat("/api","/tips/").concat(e,"/read"));case 2:return a=t.sent,t.abrupt("return",a);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},E=function(t){return Object(f.a)({},t,{createdAt:new Date(t.createdAt),readAt:t.read?new Date(t.readAt):null})},y={tipdata:[],processing:!0,error:null,isSearchActive:!1},h=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:y,e=arguments.length>1?arguments[1]:void 0;switch(e.type){case"INIT_GET_TIPS":return Object(f.a)({},t,{processing:!0});case"GET_TIPS_SUCCESS":return Object(f.a)({},t,{tipdata:t.tipdata.concat(e.data),processing:!1,error:null});case"INIT_ADD_TIP":return Object(f.a)({},t,{processing:!0});case"ADD_TIP_SUCCESS":return Object(f.a)({},t,{tipdata:t.tipdata.concat(e.data),processing:!1,error:null});case"INIT_REMOVE_TIP":return Object(f.a)({},t,{processing:!0});case"REMOVE_TIP_SUCCESS":return Object(f.a)({},t,{tipdata:t.tipdata.filter((function(t){return t.id!==e.data})),processing:!1,error:null});case"INIT_SEARCH_TIPS":return Object(f.a)({},t,{processing:!0,isSearchActive:!0});case"SEARCH_TIPS_SUCCESS":return Object(f.a)({},t,{tipdata:e.data,processing:!1,error:null});case"REMOVE_SEARCH_FILTER_SUCCESS":return Object(f.a)({},t,{tipdata:e.data,processing:!1,error:null,isSearchActive:!1});case"INIT_READ_TIP":return Object(f.a)({},t,{processing:!0});case"READ_SUCCESS":var a=e.data;return Object(f.a)({},t,{tipdata:t.tipdata.map((function(t){return t.id===a.id?a:t})),processing:!1,error:null});case"UPDATE_TIP":var n=e.data;return Object(f.a)({},t,{tipdata:t.tipdata.map((function(t){return t.id!==n.id?t:n}))});case"ACTION_FAIL":return window.alert("Toiminto ep\xe4onnistui (".concat(e.data,")")),Object(f.a)({},t,{error:e.data,processing:!1});default:return t}},k=a(13),_=function(t){var e=t.buttonText,a=t.priority,n=t.type,c=t.cyDataAttribute,i=t.onClick;return r.a.createElement("div",{className:"button__container"},r.a.createElement("button",{className:"button button-".concat(a," button-").concat(n),"data-cy":c,id:"button-".concat(c),type:n,onClick:i},e))},T=function(){return r.a.createElement("div",null,"Lataillaan...")},g=Object(s.b)((function(){return{}}),{updateTip:function(t,e){return function(){var a=Object(d.a)(p.a.mark((function a(n){var r;return p.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,b.update(t,e);case 3:r=a.sent,n({type:"UPDATE_TIP",data:E(r.data)}),a.next=10;break;case 7:a.prev=7,a.t0=a.catch(0),n({type:"ACTION_FAIL",data:a.t0.response.data.error});case 10:case"end":return a.stop()}}),a,null,[[0,7]])})));return function(t){return a.apply(this,arguments)}}()}})((function(t){var e=Object(n.useState)(null),a=Object(k.a)(e,2),c=a[0],i=a[1],u=Object(n.useState)(!1),s=Object(k.a)(u,2),l=s[0],p=s[1],d=Object(o.f)();Object(n.useEffect)((function(){b.getById(t.id).then((function(t){i(function(t){return Object(f.a)({},t,{createdAt:new Date(t.createdAt),readAt:t.read?new Date(t.readAt):null})}(t.data)),p(t.data.read)}))}),[t.id]);return c?r.a.createElement("div",{className:"form form--add-tip"},r.a.createElement("h3",null,"P\xe4ivit\xe4 vinkin tiedot"),r.a.createElement("p",null,"Vinkki luotu ",c.createdAt.toLocaleString("fi-FI")),r.a.createElement("form",{onSubmit:function(e){e.preventDefault();var a={title:e.target.title.value.trim(),url:e.target.url.value,tags:e.target.tags.value.split(",").map((function(t){return t.trim()})).filter((function(t){return t.length>0}))};l||(a=Object(f.a)({},a,{read:!1,readAt:null})),t.updateTip(c.id,a),d.push("/")}},r.a.createElement("div",{className:"form__field form__field--text"},r.a.createElement("label",null,"Otsikko"),r.a.createElement("input",{type:"text",name:"title",defaultValue:c.title,id:"input-Otsikko"})),r.a.createElement("div",{className:"form__field form__field--text"},r.a.createElement("label",null,"Linkki"),r.a.createElement("input",{type:"text",name:"url",defaultValue:c.url,id:"input-Url"})),r.a.createElement("div",{className:"form__field form__field--text"},r.a.createElement("label",null,"Tagit"),r.a.createElement("input",{type:"text",name:"tags",defaultValue:c.tags.join(", "),id:"input-Tagit"})),c.read&&r.a.createElement(r.a.Fragment,null,r.a.createElement("div",null,r.a.createElement("label",null,"Merkkaa lukemattomaksi poistamalla valinta"),r.a.createElement("p",null,r.a.createElement("input",{type:"checkbox",id:"tip-unread",checked:l,onChange:function(){return p(!l)}}),"Luettu ",c.readAt.toLocaleString("fi-FI")))),r.a.createElement(_,{buttonText:"P\xe4ivit\xe4",id:"tip-update",priority:"primary",type:"submit",cyDataAttribute:"update-tip"}),r.a.createElement(_,{buttonText:"Palaa takaisin",priority:"secondary",onClick:function(){return d.push("/")}}))):r.a.createElement(T,null)})),S=function(t){var e=Object(n.useState)(""),a=Object(k.a)(e,2),r=a[0],c=a[1];return{type:t,value:r,onChange:function(t){c(t.target.value)},reset:function(){c("")}}},A=a(37),x=function(t){var e=t.label,a=t.inputValue;return r.a.createElement("div",{className:"form__field form__field--text"},r.a.createElement("label",null,e),r.a.createElement("input",Object.assign({"data-cy":"tip-url",id:"input-".concat(e)},function(t){t.reset;return Object(A.a)(t,["reset"])}(a))))},I=Object(s.b)((function(){return{}}),{addTip:function(t){return function(){var e=Object(d.a)(p.a.mark((function e(a){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a({type:"INIT_ADD_TIP"}),e.prev=1,e.next=4,b.create(t);case 4:n=e.sent,a({type:"ADD_TIP_SUCCESS",data:E(n.data)}),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),a({type:"ACTION_FAIL",data:e.t0.response.data.error});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()}})((function(t){var e=S("text"),a=S("text"),n=S("text");return r.a.createElement("div",{className:"form form--add-tip"},r.a.createElement("h3",null,"Lis\xe4\xe4 vinkki"),r.a.createElement("form",{onSubmit:function(r){r.preventDefault(),t.addTip({title:e.value.trim(),url:a.value.trim(),tags:n.value.split(",").map((function(t){return t.trim()})).filter((function(t){return t.length>0}))}),e.reset(),a.reset(),n.reset()}},r.a.createElement(x,{label:"Otsikko",inputValue:e}),r.a.createElement(x,{label:"Linkki",inputValue:a}),r.a.createElement(x,{label:"Tagit",inputValue:n}),r.a.createElement(_,{buttonText:"Lis\xe4\xe4",priority:"primary",type:"submit",cyDataAttribute:"add-tip"})))})),O=function(t){var e=t.tip,a=t.deleteTip,n=t.readTip,c=Object(o.f)();return r.a.createElement("div",{id:"tip-list-item","data-cy":"tip-item",key:e.id,className:"tip-list-item"},r.a.createElement("div",{className:"tip-content"},r.a.createElement("div",{className:"timestamp"},e.createdAt.toLocaleString("fi-FI")),e.read&&r.a.createElement("div",{className:"timestamp-read"},"Luettu ",e.readAt.toLocaleString("fi-FI")),r.a.createElement("h3",null,e.title),r.a.createElement("a",{href:e.url},e.url),r.a.createElement("div",{className:"tip-item__meta tip-item__meta--tags"},e.tags.map((function(t,a){return r.a.createElement("span",{key:"".concat(a,"-").concat(t,"-").concat(e.id),className:"tag_item"},r.a.createElement("span",null,t),a!==e.tags.length-1&&r.a.createElement("span",{className:"sep"},","))}))),r.a.createElement(_,{onClick:function(){return a(e)},buttonText:"Poista",priority:"secondary",type:"button",cyDataAttribute:"remove-tip"}),!e.read&&r.a.createElement(_,{onClick:function(){return n(e)},buttonText:"Luettu",priority:"secondary",type:"button",cyDataAttribute:"read-tip"}),r.a.createElement(_,{onClick:function(){return c.push("/tips/".concat(e.id,"/edit"))},buttonText:"Muokkaa",priority:"secondary",type:"button",cyDataAttribute:"remove-tip"})))},j=Object(s.b)((function(t){return{isSearchActive:t.tips.isSearchActive}}),{})((function(t){return t.isSearchActive?r.a.createElement("div",null,r.a.createElement("p",null,"Ei hakutuloksia :(")):r.a.createElement("div",null,r.a.createElement("p",null,"Et ole lis\xe4nnyt vinkkej\xe4 viel\xe4"))})),C=Object(s.b)((function(t){return{tips:t.tips}}),{removeTip:function(t){return function(){var e=Object(d.a)(p.a.mark((function e(a){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a({type:"INIT_REMOVE_TIP"}),e.prev=1,e.next=4,b.remove(t);case 4:n=e.sent,e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),n=e.t0;case 10:204===n.status?a({type:"REMOVE_TIP_SUCCESS",data:t}):a({type:"ACTION_FAIL",data:n});case 11:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t){return e.apply(this,arguments)}}()},readTip:function(t){return function(){var e=Object(d.a)(p.a.mark((function e(a){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a({type:"INIT_READ_TIP"}),e.prev=1,e.next=4,b.read(t);case 4:n=e.sent,a({type:"READ_SUCCESS",data:E(n.data)}),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),a({type:"ACTION_FAIL",data:e.t0.response.data.error});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()}})((function(t){var e=t.tips,a=e.processing,n=e.tipdata;if(a&&0===n.length)return r.a.createElement(T,null);if(0===n.length)return r.a.createElement(j,null);console.log("TipList: tipdata",n);var c=function(){var e=Object(d.a)(p.a.mark((function e(a){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:window.confirm("Poistetaanko lukuvinkki '".concat(a.title,"'?"))&&t.removeTip(a.id);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),i=function(){var e=Object(d.a)(p.a.mark((function e(a){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.readTip(a.id);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return r.a.createElement("div",null,r.a.createElement("h2",null,"Lukuvinkit"),r.a.createElement("div",{id:"tip-list"},n.sort((function(t,e){return e.createdAt-t.createdAt})).map((function(t){return r.a.createElement(O,{key:t.id,tip:t,deleteTip:c,readTip:i})}))))})),w=Object(s.b)((function(t){return{isSearchActive:t.tips.isSearchActive}}),{searchByTerms:function(t){return function(){var e=Object(d.a)(p.a.mark((function e(a){var n,r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a({type:"INIT_SEARCH_TIPS"}),0!==t.title.length){e.next=7;break}return e.next=4,b.getAll();case 4:n=e.sent,e.next=10;break;case 7:return e.next=9,b.getByTitle(t.title);case 9:n=e.sent;case 10:200===n.status?(r=n.data.map(E),a({type:"SEARCH_TIPS_SUCCESS",data:r})):a({type:"ACTION_FAIL",data:n});case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},searchByTag:function(t){return function(){var e=Object(d.a)(p.a.mark((function e(a){var n,r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a({type:"INIT_SEARCH_TIPS"}),e.prev=1,0!==t.tag.length){e.next=8;break}return e.next=5,b.getAll();case 5:n=e.sent,e.next=11;break;case 8:return e.next=10,b.getByTag(t.tag);case 10:n=e.sent;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(1),n=e.t0;case 16:200===n.status?(r=n.data.map(E),a({type:"SEARCH_TIPS_SUCCESS",data:r})):a({type:"ACTION_FAIL",data:n});case 17:case"end":return e.stop()}}),e,null,[[1,13]])})));return function(t){return e.apply(this,arguments)}}()},searchUnreadedTips:function(t){return function(){var e=Object(d.a)(p.a.mark((function e(a){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a({type:"INIT_SEARCH_TIPS"}),e.prev=1,!t.unreadedTips){e.next=8;break}return e.next=5,b.getAllUnread();case 5:n=e.sent,e.next=11;break;case 8:return e.next=10,b.getAll();case 10:n=e.sent;case 11:a({type:"SEARCH_TIPS_SUCCESS",data:n.data.map(E)}),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(1),a({type:"ACTION_FAIL",data:e.t0.response.data.error});case 17:case"end":return e.stop()}}),e,null,[[1,14]])})));return function(t){return e.apply(this,arguments)}}()},removeSearchFilter:function(){return function(){var t=Object(d.a)(p.a.mark((function t(e){var a,n;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e({type:"INIT_GET_TIPS"}),t.next=3,b.getAll();case 3:200===(a=t.sent).status?(n=a.data.map(E),e({type:"REMOVE_SEARCH_FILTER_SUCCESS",data:n})):e({type:"ACTION_FAIL",data:a});case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}})((function(t){var e=S("text"),a=S("text"),c=Object(n.useState)(!1),i=Object(k.a)(c,2),u=i[0],s=i[1];return r.a.createElement("div",{className:"search-form__wrapper"},r.a.createElement("form",{className:"search__form search__form--title",onSubmit:function(n){n.preventDefault(),a.reset(),s(!1),t.searchByTerms({title:e.value.trim()})}},r.a.createElement(x,{label:"Etsi vinkkej\xe4 otsikolla",inputValue:e}),r.a.createElement(_,{buttonText:"Hae",priority:"primary",type:"submit",cyDataAttribute:"search-by-tip-title"})),r.a.createElement("form",{className:"search__form search__form--tags",onSubmit:function(n){n.preventDefault(),e.reset(),s(!1),t.searchByTag({tag:a.value.trim()})}},r.a.createElement(x,{label:"Etsi vinkkej\xe4 tagilla",inputValue:a}),r.a.createElement(_,{buttonText:"Hae",priority:"primary",type:"submit",cyDataAttribute:"search-by-tip-tag"})),r.a.createElement("form",{className:"search__form search__form--unreaded-tags",onSubmit:function(n){n.preventDefault(),a.reset(),e.reset(),t.searchUnreadedTips({unreadedTips:u})}},r.a.createElement("label",null,"Etsi kaikki tai lukemattomat vinkit"),r.a.createElement("input",{type:"checkbox",id:"checkbox-unreaded-tips",checked:u,onChange:function(){return s(!u)}}),"n\xe4yt\xe4 vain lukemattomat",r.a.createElement("br",null),r.a.createElement(_,{buttonText:"Hae",priority:"primary",type:"submit",cyDataAttribute:"search-unreaded-tags"})),t.isSearchActive&&r.a.createElement(_,{onClick:function(){return e.reset(),a.reset(),s(!1),void t.removeSearchFilter()},buttonText:"Poista hakusuodatin",priority:"secondary",type:"button",cyDataAttribute:"remove-search-filter"}))})),N=Object(s.b)((function(t){return{tips:t.tips}}),{initTips:function(){return function(){var t=Object(d.a)(p.a.mark((function t(e){var a,n;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e({type:"INIT_GET_TIPS"}),t.next=3,b.getAll();case 3:200===(a=t.sent).status?(n=a.data.map(E),e({type:"GET_TIPS_SUCCESS",data:n})):e({type:"ACTION_FAIL",data:a});case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}})((function(t){Object(n.useEffect)((function(){t.tips.processing&&t.initTips()}),[]);var e=Object(o.g)("/tips/:id/edit");return r.a.createElement("div",{className:"App"},r.a.createElement("h1",{className:"heading heading__h1"},"Lukuvinkkikirjasto"),r.a.createElement("div",{className:"content-container"},r.a.createElement(o.c,null,r.a.createElement(o.a,{path:"/tips/:id/edit"},e?r.a.createElement(g,{id:e.params.id}):null),r.a.createElement(o.a,{path:"/",render:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(I,null),r.a.createElement(w,null),r.a.createElement(C,null))}}))))})),D=a(15),P=a(36),L=Object(D.c)({tips:h}),R=Object(D.d)(L,Object(D.a)(P.a));R.subscribe((function(){return console.log(R.getState())}));var U=R,F=(a(66),function(){i.a.render(r.a.createElement(s.a,{store:U},r.a.createElement(u.a,null,r.a.createElement(N,null))),document.getElementById("app"))});F(),U.subscribe(F)}},[[38,1,2]]]);
//# sourceMappingURL=main.bb658c9c.chunk.js.map